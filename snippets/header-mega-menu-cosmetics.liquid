{% doc %}
  Header Mega Menu - Cosmetics

  Renders a custom mega menu panel for the cosmetics collection.

  @param {linklist} cosmetics_menu - Secondary menu for cosmetics collections
{% enddoc %}

{% liquid
  assign cosmetics_menu = cosmetics_menu | default: empty

  # Prefer explicit cosmetics collection handles, fall back if needed
  assign cosmetics_collection = collections.kozmetika | default: collections.cosmetics

  # Use featured_products metafield when available, otherwise fall back to collection products
  assign featured_products = blank

  if cosmetics_collection.metafields.custom and cosmetics_collection.metafields.custom.featured_products
    assign featured_products = cosmetics_collection.metafields.custom.featured_products.value
  endif

  if featured_products == blank
    assign featured_products = cosmetics_collection.products
  endif

  unless cosmetics_collection and cosmetics_collection != empty
    break
  endunless
%}

<div
  class="mega-menu-panel pointer-events-none absolute left-0 top-[calc(100%-16px)] w-full aria-[hidden=false]:pointer-events-auto"
  data-mega-menu-panel="{{ cosmetics_collection.handle }}"
  aria-hidden="true"
>
  <div class="container py-3">
    <div
      class="mega-menu-card rounded-2xl border border-black/12 bg-[var(--color-background-default)]"
      data-mega-menu-card
    >
      <div class="grid gap-8 p-8 md:grid-cols-[minmax(260px,320px)_1fr]">
        <div class="flex flex-col gap-4">
          {% if cosmetics_menu and cosmetics_menu.links.size > 0 %}
            <h3 class="text-lg font-semibold text-primary">
              {{ cosmetics_collection.title }}
            </h3>

            <ul class="m-0 list-none space-y-2 p-0">
              {% for menu_link in cosmetics_menu.links %}
                <li>
                  <a
                    href="{{ menu_link.url }}"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    {{ menu_link.title }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>

        <div class="grid gap-6 md:grid-cols-3">
          {% for product in featured_products limit: 3 %}
            {% render 'product-card', product: product, hide_buy_form: true %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
