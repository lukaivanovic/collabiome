{% comment %}
  Facets/filters snippet for collection filtering
  Uses Shopify native filters with URL-based filtering
  Supports both sidebar (desktop) and drawer (mobile) contexts
{% endcomment %}

{% liquid
  assign filters = collection.filters
  assign has_active_filters = false

  for filter in filters
    if filter.active_values.size > 0
      assign has_active_filters = true
      break
    endif
  endfor
%}

{% comment %} Desktop sidebar version {% endcomment %}
<facet-filter-form class="facets hidden md:block">
  <form id="FacetFiltersForm" class="facets__form">
    {% comment %} Active filters {% endcomment %}
    {% if has_active_filters %}
      <div class="facets__active">
        <h3 class="facets__heading">{{ 'filters.active_filters' | t | default: 'Active filters' }}</h3>
        <div class="facets__active-list">
          {% for filter in filters %}
            {% for value in filter.active_values %}
              <a href="{{ value.url_to_remove }}" class="facets__active-item">
                <span>{{ filter.label }}: {{ value.label }}</span>
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M9 3L3 9M3 3L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </a>
            {% endfor %}
          {% endfor %}
        </div>
        <a href="{{ collection.url }}" class="facets__clear-all">
          {{ 'filters.clear_all' | t | default: 'Clear all' }}
        </a>
      </div>
    {% endif %}

    {% comment %} Filter groups {% endcomment %}
    <div class="facets__groups">
      {% for filter in filters %}
        <div class="facets__group">
          <details class="facets__details" open>
            <summary class="facets__summary">
              <span class="facets__label">{{ filter.label }}</span>
              {% if filter.active_values.size > 0 %}
                <span class="facets__count">({{ filter.active_values.size }})</span>
              {% endif %}
            </summary>

            <div class="facets__content">
              {% case filter.type %}
                {% when 'list' %}
                  <ul class="facets__list">
                    {% for value in filter.values %}
                      <li class="facets__item">
                        <label class="facets__checkbox-label">
                          <input
                            type="checkbox"
                            name="{{ filter.param_name }}"
                            value="{{ value.value }}"
                            class="facets__checkbox"
                            {% if value.active %}
                              checked
                            {% endif %}
                            {% if value.count == 0 and value.active == false %}
                              disabled
                            {% endif %}
                          >
                          <span class="facets__checkbox-text">
                            {{ value.label }}
                            <span class="facets__count">({{ value.count }})</span>
                          </span>
                        </label>
                      </li>
                    {% endfor %}
                  </ul>

                {% when 'price_range' %}
                  <div class="facets__price-range">
                    <div class="facets__price-inputs">
                      <label class="facets__price-label">
                        <span>{{ 'filters.price_from' | t | default: 'From' }}</span>
                        <input
                          type="number"
                          name="{{ filter.min_value.param_name }}"
                          value="{{ filter.min_value.value | default: '' }}"
                          placeholder="{{ filter.range_min | money_without_currency }}"
                          class="facets__price-input"
                        >
                      </label>
                      <label class="facets__price-label">
                        <span>{{ 'filters.price_to' | t | default: 'To' }}</span>
                        <input
                          type="number"
                          name="{{ filter.max_value.param_name }}"
                          value="{{ filter.max_value.value | default: '' }}"
                          placeholder="{{ filter.range_max | money_without_currency }}"
                          class="facets__price-input"
                        >
                      </label>
                    </div>
                    <div class="facets__price-range-display">
                      {{ filter.range_min | money }} - {{ filter.range_max | money }}
                    </div>
                  </div>

                {% when 'boolean' %}
                  <ul class="facets__list">
                    <li class="facets__item">
                      <label class="facets__checkbox-label">
                        <input
                          type="checkbox"
                          name="{{ filter.param_name }}"
                          value="{{ filter.true_value.value }}"
                          class="facets__checkbox"
                          {% if filter.true_value.active %}
                            checked
                          {% endif %}
                          {% if filter.true_value.count == 0 and filter.true_value.active == false %}
                            disabled
                          {% endif %}
                        >
                        <span class="facets__checkbox-text">
                          {{ filter.true_value.label }}
                          <span class="facets__count">({{ filter.true_value.count }})</span>
                        </span>
                      </label>
                    </li>
                    <li class="facets__item">
                      <label class="facets__checkbox-label">
                        <input
                          type="checkbox"
                          name="{{ filter.param_name }}"
                          value="{{ filter.false_value.value }}"
                          class="facets__checkbox"
                          {% if filter.false_value.active %}
                            checked
                          {% endif %}
                          {% if filter.false_value.count == 0 and filter.false_value.active == false %}
                            disabled
                          {% endif %}
                        >
                        <span class="facets__checkbox-text">
                          {{ filter.false_value.label }}
                          <span class="facets__count">({{ filter.false_value.count }})</span>
                        </span>
                      </label>
                    </li>
                  </ul>
              {% endcase %}
            </div>
          </details>
        </div>
      {% endfor %}
    </div>

    <div class="facets__footer">
      <button type="submit" class="facets__submit">
        {{ 'filters.apply' | t | default: 'Apply filters' }}
      </button>
    </div>
  </form>
</facet-filter-form>

{% comment %} Mobile drawer version {% endcomment %}
<facet-filter-form class="facets block md:hidden" id="FacetFiltersFormMobile">
  <form id="FacetFiltersFormMobile" class="facets__form">
    {% comment %} Active filters {% endcomment %}
    {% if has_active_filters %}
      <div class="facets__active">
        <h3 class="facets__heading">{{ 'filters.active_filters' | t | default: 'Active filters' }}</h3>
        <div class="facets__active-list">
          {% for filter in filters %}
            {% for value in filter.active_values %}
              <a href="{{ value.url_to_remove }}" class="facets__active-item">
                <span>{{ filter.label }}: {{ value.label }}</span>
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M9 3L3 9M3 3L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </a>
            {% endfor %}
          {% endfor %}
        </div>
        <a href="{{ collection.url }}" class="facets__clear-all">
          {{ 'filters.clear_all' | t | default: 'Clear all' }}
        </a>
      </div>
    {% endif %}

    {% comment %} Filter groups {% endcomment %}
    <div class="facets__groups">
      {% for filter in filters %}
        <div class="facets__group">
          <details class="facets__details" open>
            <summary class="facets__summary">
              <span class="facets__label">{{ filter.label }}</span>
              {% if filter.active_values.size > 0 %}
                <span class="facets__count">({{ filter.active_values.size }})</span>
              {% endif %}
            </summary>

            <div class="facets__content">
              {% case filter.type %}
                {% when 'list' %}
                  <ul class="facets__list">
                    {% for value in filter.values %}
                      <li class="facets__item">
                        <label class="facets__checkbox-label">
                          <input
                            type="checkbox"
                            name="{{ filter.param_name }}"
                            value="{{ value.value }}"
                            class="facets__checkbox"
                            {% if value.active %}
                              checked
                            {% endif %}
                            {% if value.count == 0 and value.active == false %}
                              disabled
                            {% endif %}
                          >
                          <span class="facets__checkbox-text">
                            {{ value.label }}
                            <span class="facets__count">({{ value.count }})</span>
                          </span>
                        </label>
                      </li>
                    {% endfor %}
                  </ul>

                {% when 'price_range' %}
                  <div class="facets__price-range">
                    <div class="facets__price-inputs">
                      <label class="facets__price-label">
                        <span>{{ 'filters.price_from' | t | default: 'From' }}</span>
                        <input
                          type="number"
                          name="{{ filter.min_value.param_name }}"
                          value="{{ filter.min_value.value | default: '' }}"
                          placeholder="{{ filter.range_min | money_without_currency }}"
                          class="facets__price-input"
                        >
                      </label>
                      <label class="facets__price-label">
                        <span>{{ 'filters.price_to' | t | default: 'To' }}</span>
                        <input
                          type="number"
                          name="{{ filter.max_value.param_name }}"
                          value="{{ filter.max_value.value | default: '' }}"
                          placeholder="{{ filter.range_max | money_without_currency }}"
                          class="facets__price-input"
                        >
                      </label>
                    </div>
                    <div class="facets__price-range-display">
                      {{ filter.range_min | money }} - {{ filter.range_max | money }}
                    </div>
                  </div>

                {% when 'boolean' %}
                  <ul class="facets__list">
                    <li class="facets__item">
                      <label class="facets__checkbox-label">
                        <input
                          type="checkbox"
                          name="{{ filter.param_name }}"
                          value="{{ filter.true_value.value }}"
                          class="facets__checkbox"
                          {% if filter.true_value.active %}
                            checked
                          {% endif %}
                          {% if filter.true_value.count == 0 and filter.true_value.active == false %}
                            disabled
                          {% endif %}
                        >
                        <span class="facets__checkbox-text">
                          {{ filter.true_value.label }}
                          <span class="facets__count">({{ filter.true_value.count }})</span>
                        </span>
                      </label>
                    </li>
                    <li class="facets__item">
                      <label class="facets__checkbox-label">
                        <input
                          type="checkbox"
                          name="{{ filter.param_name }}"
                          value="{{ filter.false_value.value }}"
                          class="facets__checkbox"
                          {% if filter.false_value.active %}
                            checked
                          {% endif %}
                          {% if filter.false_value.count == 0 and filter.false_value.active == false %}
                            disabled
                          {% endif %}
                        >
                        <span class="facets__checkbox-text">
                          {{ filter.false_value.label }}
                          <span class="facets__count">({{ filter.false_value.count }})</span>
                        </span>
                      </label>
                    </li>
                  </ul>
              {% endcase %}
            </div>
          </details>
        </div>
      {% endfor %}
    </div>

    <div class="facets__footer">
      <button type="submit" class="facets__submit">
        {{ 'filters.apply' | t | default: 'Apply filters' }}
      </button>
    </div>
  </form>
</facet-filter-form>

{% stylesheet %}
  .facets {
    display: block;
  }

  .facets__form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .facets__active {
    padding: 1rem;
    background: #f9fafb;
    border-radius: 0.5rem;
    border: 1px solid #e5e7eb;
  }

  .facets__heading {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: #374151;
  }

  .facets__active-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .facets__active-item {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    background: #374151;
    color: white;
    border-radius: 0.25rem;
    text-decoration: none;
    font-size: 0.75rem;
    transition: background-color 0.2s;
  }

  .facets__active-item:hover {
    background: #1f2937;
  }

  .facets__clear-all {
    color: #6b7280;
    text-decoration: underline;
    font-size: 0.875rem;
  }

  .facets__clear-all:hover {
    color: #374151;
  }

  .facets__groups {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .facets__group {
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
  }

  .facets__details {
    display: block;
  }

  .facets__summary {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    cursor: pointer;
    list-style: none;
    font-weight: 500;
    color: #374151;
  }

  .facets__summary::-webkit-details-marker {
    display: none;
  }

  .facets__summary::after {
    content: '+';
    font-size: 1.25rem;
    transition: transform 0.2s;
  }

  .facets__details[open] .facets__summary::after {
    transform: rotate(45deg);
  }

  .facets__label {
    font-size: 0.875rem;
  }

  .facets__count {
    color: #6b7280;
    font-weight: normal;
  }

  .facets__content {
    padding: 0 1rem 1rem;
    border-top: 1px solid #e5e7eb;
  }

  .facets__list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .facets__item {
    display: block;
  }

  .facets__checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    padding: 0.25rem 0;
    font-size: 0.875rem;
  }

  .facets__checkbox {
    width: 1rem;
    height: 1rem;
    cursor: pointer;
    flex-shrink: 0;
  }

  .facets__checkbox-text {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    color: #374151;
  }

  .facets__price-range {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .facets__price-inputs {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .facets__price-label {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    font-size: 0.875rem;
    color: #374151;
  }

  .facets__price-input {
    padding: 0.5rem;
    border: 1px solid #d1d5db;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  .facets__price-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 1px #3b82f6;
  }

  .facets__price-range-display {
    font-size: 0.75rem;
    color: #6b7280;
    text-align: center;
  }

  .facets__footer {
    padding-top: 1rem;
    border-top: 1px solid #e5e7eb;
  }

  .facets__submit {
    width: 100%;
    padding: 0.75rem 1rem;
    background: #000;
    color: white;
    border: none;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .facets__submit:hover {
    background: #374151;
  }

  @media (max-width: 768px) {
    .facets__active-list {
      flex-direction: column;
    }

    .facets__price-inputs {
      flex-direction: row;
    }
  }
{% endstylesheet %}
