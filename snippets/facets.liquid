{% comment %}
  Facets/filters snippet for collection filtering
  Uses Shopify native filters with URL-based filtering
  Horizontal multi-select dropdown layout
{% endcomment %}

{% liquid
  assign filters = collection.filters
  assign has_active_filters = false

  for filter in filters
    if filter.active_values.size > 0
      assign has_active_filters = true
      break
    endif
  endfor
%}

{% comment %} Horizontal filters with dropdowns {% endcomment %}
<facet-filter-form>
  <form id="FacetFiltersForm" class="flex flex-col gap-4">
    {% comment %} Active filters {% endcomment %}
    {% if has_active_filters %}
      <div class="flex justify-between items-center flex-wrap gap-3 px-4 py-3 bg-gray-50 rounded-lg border border-gray-200">
        <div class="flex flex-wrap gap-2">
          {% for filter in filters %}
            {% for value in filter.active_values %}
              <a
                href="{{ value.url_to_remove }}"
                class="flex items-center gap-1 px-2 py-1 bg-gray-700 text-white rounded text-xs no-underline transition-colors hover:bg-gray-800"
              >
                <span>{{ filter.label }}: {{ value.label }}</span>
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M9 3L3 9M3 3L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </a>
            {% endfor %}
          {% endfor %}
        </div>
        <a href="{{ collection.url }}" class="text-gray-500 underline text-sm whitespace-nowrap hover:text-gray-700">
          {{ 'filters.clear_all' | t | default: 'Clear all' }}
        </a>
      </div>
    {% endif %}

    {% comment %} Filter dropdowns {% endcomment %}
    <div class="flex flex-wrap md:flex-row flex-col md:gap-3 gap-2 items-start">
      {% for filter in filters %}
        {% case filter.type %}
          {% when 'list' %}
            <facet-select class="relative inline-block" data-filter-label="{{ filter.label }}">
              <button
                type="button"
                data-select-button
                class="flex items-center justify-between gap-2 px-4 py-2.5 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 cursor-pointer transition-all hover:border-gray-400 hover:bg-gray-50 whitespace-nowrap w-full md:w-auto"
                aria-expanded="false"
              >
                {{ filter.label }}
              </button>
              <div
                class="absolute top-[calc(100%+0.25rem)] left-0 z-50 min-w-[200px] max-w-[280px] w-full md:w-auto max-h-[300px] overflow-y-auto bg-white border border-gray-300 rounded-md shadow-lg hidden"
                data-select-panel
              >
                <ul class="list-none p-2 m-0 flex flex-col gap-1">
                  {% for value in filter.values %}
                    <li class="block">
                      <label class="flex items-center gap-2 cursor-pointer py-1.5 px-2 rounded text-sm transition-colors hover:bg-gray-100">
                        <input
                          type="checkbox"
                          name="{{ filter.param_name }}"
                          value="{{ value.value }}"
                          class="w-4 h-4 cursor-pointer flex-shrink-0"
                          {% if value.active %}
                            checked
                          {% endif %}
                          {% if value.count == 0 and value.active == false %}
                            disabled
                          {% endif %}
                        >
                        <span class="flex items-center gap-1 text-gray-700">
                          {{ value.label }}
                          <span class="text-gray-500 font-normal">({{ value.count }})</span>
                        </span>
                      </label>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </facet-select>

          {% when 'boolean' %}
            <facet-select class="relative inline-block" data-filter-label="{{ filter.label }}">
              <button
                type="button"
                data-select-button
                class="flex items-center justify-between gap-2 px-4 py-2.5 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 cursor-pointer transition-all hover:border-gray-400 hover:bg-gray-50 whitespace-nowrap w-full md:w-auto"
                aria-expanded="false"
              >
                {{ filter.label }}
              </button>
              <div
                class="absolute top-[calc(100%+0.25rem)] left-0 z-50 min-w-[200px] max-w-[280px] w-full md:w-auto max-h-[300px] overflow-y-auto bg-white border border-gray-300 rounded-md shadow-lg hidden"
                data-select-panel
              >
                <ul class="list-none p-2 m-0 flex flex-col gap-1">
                  <li class="block">
                    <label class="flex items-center gap-2 cursor-pointer py-1.5 px-2 rounded text-sm transition-colors hover:bg-gray-100">
                      <input
                        type="checkbox"
                        name="{{ filter.param_name }}"
                        value="{{ filter.true_value.value }}"
                        class="w-4 h-4 cursor-pointer flex-shrink-0"
                        {% if filter.true_value.active %}
                          checked
                        {% endif %}
                        {% if filter.true_value.count == 0 and filter.true_value.active == false %}
                          disabled
                        {% endif %}
                      >
                      <span class="flex items-center gap-1 text-gray-700">
                        {{ filter.true_value.label }}
                        <span class="text-gray-500 font-normal">({{ filter.true_value.count }})</span>
                      </span>
                    </label>
                  </li>
                  <li class="block">
                    <label class="flex items-center gap-2 cursor-pointer py-1.5 px-2 rounded text-sm transition-colors hover:bg-gray-100">
                      <input
                        type="checkbox"
                        name="{{ filter.param_name }}"
                        value="{{ filter.false_value.value }}"
                        class="w-4 h-4 cursor-pointer flex-shrink-0"
                        {% if filter.false_value.active %}
                          checked
                        {% endif %}
                        {% if filter.false_value.count == 0 and filter.false_value.active == false %}
                          disabled
                        {% endif %}
                      >
                      <span class="flex items-center gap-1 text-gray-700">
                        {{ filter.false_value.label }}
                        <span class="text-gray-500 font-normal">({{ filter.false_value.count }})</span>
                      </span>
                    </label>
                  </li>
                </ul>
              </div>
            </facet-select>

          {% when 'price_range' %}
            <div class="flex flex-col md:flex-row md:items-center items-start gap-3 px-4 py-2.5 bg-white border border-gray-300 rounded-md w-full">
              <label class="text-sm font-medium text-gray-700 whitespace-nowrap">{{ filter.label }}</label>
              <div class="flex gap-2 items-center w-full md:w-auto">
                <label class="flex items-center gap-1 text-sm text-gray-700">
                  <span>{{ 'filters.price_from' | t | default: 'From' }}</span>
                  <input
                    type="number"
                    name="{{ filter.min_value.param_name }}"
                    value="{{ filter.min_value.value | default: '' }}"
                    placeholder="{{ filter.range_min | money_without_currency }}"
                    class="px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 w-20 md:w-20 flex-1 md:flex-initial"
                  >
                </label>
                <label class="flex items-center gap-1 text-sm text-gray-700">
                  <span>{{ 'filters.price_to' | t | default: 'To' }}</span>
                  <input
                    type="number"
                    name="{{ filter.max_value.param_name }}"
                    value="{{ filter.max_value.value | default: '' }}"
                    placeholder="{{ filter.range_max | money_without_currency }}"
                    class="px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 w-20 md:w-20 flex-1 md:flex-initial"
                  >
                </label>
              </div>
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </form>
</facet-filter-form>

{% stylesheet %}
  /* Dropdown chevron icon */
  [data-select-button]::after {
    content: 'â–¼';
    font-size: 0.625rem;
    transition: transform 0.2s;
  }

  [data-select-button][aria-expanded='true']::after {
    transform: rotate(180deg);
  }
{% endstylesheet %}
