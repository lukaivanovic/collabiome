{% doc %}
  Header Mega Menu

  Renders collection-based mega menu panels for the desktop header.

  @param {linklist} shop_menu - Main navigation with collection links (required)
  @param {linklist} cosmetics_menu - Secondary menu for cosmetics collections
  @param {linklist} supplements_menu - Secondary menu for supplements collections
{% enddoc %}

{% liquid
  assign shop_menu = shop_menu | default: empty
  assign cosmetics_menu = cosmetics_menu | default: empty
  assign supplements_menu = supplements_menu | default: empty

  unless shop_menu != empty and shop_menu.links.size > 0
    break
  endunless
%}

<div data-mega-menu-panels>
  {% for link in shop_menu.links %}
    {% if link.type == 'collection_link' %}
      {% liquid
        assign submenu = blank

        if link.object.handle == 'kozmetika' or link.object.handle == 'cosmetics'
          if cosmetics_menu and cosmetics_menu.links.size > 0
            assign submenu = cosmetics_menu
          endif
        elsif link.object.handle == 'dodaci-prehrani' or link.object.handle == 'supplements'
          if supplements_menu and supplements_menu.links.size > 0
            assign submenu = supplements_menu
          endif
        endif
      %}

      <div
        class="mega-menu-panel pointer-events-none absolute left-0 top-[calc(100%-16px)] w-full aria-[hidden=false]:pointer-events-auto"
        data-mega-menu-panel="{{ link.object.handle }}"
        aria-hidden="true"
      >
        <div class="container py-3">
          <div
            class="mega-menu-card rounded-2xl border border-black/12 bg-[var(--color-background-default)]"
            data-mega-menu-card
          >
            <div class="grid gap-8 p-8 md:grid-cols-[minmax(260px,320px)_1fr]">
              <div class="flex flex-col gap-4">
                {% if submenu %}
                  <h3 class="text-lg font-semibold text-primary">
                    {{ link.object.title }}
                  </h3>

                  <ul class="m-0 list-none space-y-2 p-0">
                    {% for menu_link in submenu.links %}
                      <li>
                        <a
                          href="{{ menu_link.url }}"
                          class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                        >
                          {{ menu_link.title }}
                        </a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}
              </div>

              <div class="grid gap-6 md:grid-cols-3">
                {% for product in link.object.products limit: 3 %}
                  {% render 'product-card', product: product, hide_buy_form: true %}
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>
