{%- liquid
  assign comparisons = product.metafields.custom.comparison.value
-%}

<div class="container-small">
  <h2>{{ section.settings.title | default: 'Comparison' }}</h2>

  {% if comparisons and comparisons.products and comparisons.categories and comparisons.values %}
    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead>
          <tr>
            <th class="py-2 pr-4">Category</th>
            {% for p in comparisons.products %}
              <th class="py-2 pr-4">{{ p.label }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for c in comparisons.categories %}
            <tr>
              <td class="py-2 pr-4 align-top font-medium">{{ c.label }}</td>
              {% assign category_values = comparisons.values[c.key] %}
              {% for p in comparisons.products %}
                {% assign val = category_values[p.id] %}
                <td class="py-2 pr-4 align-top">
                  {% if val %}
                    <img src="{{ 'icon-check.svg' | asset_url }}" alt="Yes" width="16" height="16">
                  {% else %}
                    <span class="opacity-60">&mdash;</span>
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="opacity-70">No comparison data.</p>
  {% endif %}
</div>

{% schema %}
{
  "name": "Product Comparison",
  "tag": "section",
  "settings": [{ "type": "text", "id": "title", "label": "Title", "default": "Comparison" }],
  "presets": [
    {
      "name": "Product Comparison",
      "category": "Product"
    }
  ]
}
{% endschema %}
