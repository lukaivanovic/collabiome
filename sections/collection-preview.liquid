{% comment %}
  Collection preview section that displays three chosen products
  from a selected collection with a button to view the full collection.
{% endcomment %}

{% liquid
  assign section_id = section.settings.custom_id | default: section.id
  assign section_class = 'section-' | append: section.type
  assign collection = collections[section.settings.collection]
  assign products_to_show = section.settings.products_to_show | default: 3
  assign show_button = section.settings.show_button | default: true
  assign button_text = section.settings.button_text | default: 'View all products'
%}

{% if collection and collection.products.size > 0 %}
  <section
    id="{{ section_id }}"
    class="{{ section_class }}"
    style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;"
  >
    <div class="container">
      {% if section.settings.heading != blank %}
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold mb-4">{{ section.settings.heading }}</h2>
          {% if section.settings.description != blank %}
            <p class="text-lg text-gray-600">{{ section.settings.description }}</p>
          {% endif %}
        </div>
      {% endif %}

      <div class="collection-preview__products grid grid-cols-1 md:grid-cols-3 gap-6">
        {% for product in collection.products limit: products_to_show %}
          <div class="collection-preview__product">
            {% render 'product-card', product: product %}
          </div>
        {% endfor %}
      </div>

      {% if show_button and collection.url %}
        <div class="text-center mt-8">
          <a
            href="{{ collection.url }}"
            class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors"
          >
            {{ button_text }}
            <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
      {% endif %}
    </div>
  </section>
{% else %}
  {% if section.settings.collection == blank %}
    <div class="container py-8">
      <div class="text-center text-gray-500">
        <p>Please select a collection to display products.</p>
      </div>
    </div>
  {% else %}
    <div class="container py-8">
      <div class="text-center text-gray-500">
        <p>No products found in this collection.</p>
      </div>
    </div>
  {% endif %}
{% endif %}

{% stylesheet %}
  .collection-preview__products {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .collection-preview__products {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .collection-preview__product {
    transition: transform 0.2s ease;
  }

  .collection-preview__product:hover {
    transform: translateY(-2px);
  }

  .collection-preview .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Collection preview",
  "tag": "section",
  "class": "collection-preview",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured products"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "info": "Optional description text to display above the products"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Number of products to show",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3
    },
    {
      "type": "checkbox",
      "id": "show_button",
      "label": "Show view all button",
      "default": true
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "View all products"
    },
    {
      "type": "text",
      "id": "custom_id",
      "label": "Custom section ID",
      "info": "Optional custom ID for styling or JavaScript targeting"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 40
    }
  ],
  "presets": [
    {
      "name": "t:sections.collection_preview.name"
    }
  ]
}
{% endschema %}
