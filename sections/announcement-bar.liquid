{% liquid
  assign section_id = section.settings.custom_id | default: section.id
  assign section_class = 'section-' | append: section.type
%}

<script defer src="{{ 'countdown.js' | asset_url }}"></script>

<section
  id="{{ section_id }}"
  class="{{ section_class }} announcement-bar full-width"
  role="region"
  aria-label="{{ 'general.announcement_bar' | t }}"
>
  <div class="announcement-bar__inner text-sm py-2">
    {% if section.settings.link_url != blank %}
      <a class="announcement-bar__link flex items-center justify-center gap-2 no-underline w-full" href="{{ section.settings.link_url }}">
        {% if section.settings.enable_countdown and section.settings.countdown_target != blank %}
          <div class="announcement-bar__countdown flex items-center justify-center gap-2" data-target="{{ section.settings.countdown_target | escape }}">
            {% if section.settings.message != blank %}
              <span class="announcement-bar__text text-center m-0">{{ section.settings.message }}</span>
            {% endif %}
            <span class="announcement-bar__timer tabular-nums whitespace-nowrap" aria-live="polite">
              {{ 'general.countdown.ends_in' | t }}
              <span class="time days">00</span>{{ 'general.time.d_short' | t }}
              <span class="time hours">00</span>{{ 'general.time.h_short' | t }}
              <span class="time minutes">00</span>{{ 'general.time.m_short' | t }}
              <span class="time seconds">00</span>{{ 'general.time.s_short' | t }}
            </span>
          </div>
        {% else %}
          <span class="announcement-bar__text text-center m-0">{{ section.settings.message }}</span>
        {% endif %}
        <span class="announcement-bar__cta underline">{{ 'general.click_here' | t }}</span>
      </a>
    {% else %}
      {% if section.settings.enable_countdown and section.settings.countdown_target != blank %}
        <div class="announcement-bar__countdown flex items-center justify-center gap-2" data-target="{{ section.settings.countdown_target | escape }}">
          {% if section.settings.message != blank %}
            <span class="announcement-bar__text text-center m-0">{{ section.settings.message }}</span>
          {% endif %}
          <span class="announcement-bar__timer tabular-nums whitespace-nowrap" aria-live="polite">
            {{ 'general.countdown.ends_in' | t }}
            <span class="time days">00</span>{{ 'general.time.d_short' | t }}
            <span class="time hours">00</span>{{ 'general.time.h_short' | t }}
            <span class="time minutes">00</span>{{ 'general.time.m_short' | t }}
            <span class="time seconds">00</span>{{ 'general.time.s_short' | t }}
          </span>
        </div>
      {% else %}
        <p class="announcement-bar__text text-center m-0">{{ section.settings.message }}</p>
      {% endif %}
    {% endif %}
  </div>
</section>

{% stylesheet %}
  .announcement-bar {
    width: 100%;
    background: var(--color-gradient1, linear-gradient(to right, #f6f6f7, #e0e0e0));
    color: var(--color-foreground, #202223);
  }
  .announcement-bar__inner {
    display: grid;
    grid-template-columns: var(--content-grid);
  }
  .announcement-bar__text {
    grid-column: 1 / -1;
  }
  .announcement-bar__link {
    grid-column: 1 / -1;
  }
  .announcement-bar__countdown {
    grid-column: 1 / -1;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Announcement bar",
  "tag": "section",
  "class": "announcement-bar",
  "settings": [
    {
      "type": "text",
      "id": "message",
      "label": "Text",
      "default": "Free shipping on orders over $50"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Link URL"
    },
    {
      "type": "checkbox",
      "id": "enable_countdown",
      "label": "Enable countdown",
      "default": false
    },
    {
      "type": "text",
      "id": "countdown_target",
      "label": "Countdown target",
      "info": "Countdown target info",
      "placeholder": "2025-12-31T23:59:59Z"
    }
  ],
  "presets": [{ "name": "Announcement bar" }]
}
{% endschema %}
