{% liquid
  assign section_id = section.settings.custom_id | default: section.id
  assign section_class = 'section-' | append: section.type
%}

<script defer src="{{ 'countdown.js' | asset_url }}"></script>

<section
  id="{{ section_id }}"
  class="{{ section_class }} announcement-bar full-width"
  role="region"
  aria-label="Announcement bar"
>
  <div class="announcement-bar__inner text-sm">
    {% if section.settings.link_url != blank %}
      <a class="announcement-bar__link" href="{{ section.settings.link_url }}">
        {% if section.settings.enable_countdown and section.settings.countdown_target != blank %}
          <div class="announcement-bar__countdown" data-target="{{ section.settings.countdown_target | escape }}">
            {% if section.settings.message != blank %}
              <span class="announcement-bar__text">{{ section.settings.message }}</span>
            {% endif %}
            <span class="announcement-bar__timer" aria-live="polite">
              Ends in
              <span class="time days">00</span>d <span class="time hours">00</span>h
              <span class="time minutes">00</span>m <span class="time seconds">00</span>s
            </span>
          </div>
        {% else %}
          <span class="announcement-bar__text">{{ section.settings.message }}</span>
        {% endif %}
        <span class="announcement-bar__cta">Click here</span>
      </a>
    {% else %}
      {% if section.settings.enable_countdown and section.settings.countdown_target != blank %}
        <div class="announcement-bar__countdown" data-target="{{ section.settings.countdown_target | escape }}">
          {% if section.settings.message != blank %}
            <span class="announcement-bar__text">{{ section.settings.message }}</span>
          {% endif %}
          <span class="announcement-bar__timer" aria-live="polite">
            Ends in
            <span class="time days">00</span>d <span class="time hours">00</span>h <span class="time minutes">00</span>m
            <span class="time seconds">00</span>s
          </span>
        </div>
      {% else %}
        <p class="announcement-bar__text">{{ section.settings.message }}</p>
      {% endif %}
    {% endif %}
  </div>
</section>

{% stylesheet %}
  .announcement-bar {
    width: 100%;
    background: var(--color-gradient-recupera, linear-gradient(to right, #f6f6f7, #e0e0e0));
    color: var(--color-foreground, #202223);
  }
  .announcement-bar__inner {
    display: grid;
    grid-template-columns: var(--content-grid);
    padding: 8px 0;
  }
  .announcement-bar__text {
    grid-column: 1 / -1;
    text-align: center;
    margin: 0;
  }
  .announcement-bar__link {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    color: inherit;
    text-decoration: none;
    width: 100%;
  }
  .announcement-bar__cta {
    text-decoration: underline;
  }
  .announcement-bar__countdown {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .announcement-bar__timer {
    font-variant-numeric: tabular-nums;
    white-space: nowrap;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Announcement bar",
  "tag": "section",
  "class": "announcement-bar",
  "settings": [
    {
      "type": "text",
      "id": "message",
      "label": "Text",
      "default": "Free shipping on orders over $50"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Link URL"
    },
    {
      "type": "checkbox",
      "id": "enable_countdown",
      "label": "Enable countdown",
      "default": false
    },
    {
      "type": "text",
      "id": "countdown_target",
      "label": "Countdown target",
      "info": "Countdown target info",
      "placeholder": "2025-12-31T23:59:59Z"
    }
  ],
  "presets": [{ "name": "Announcement bar" }]
}
{% endschema %}
